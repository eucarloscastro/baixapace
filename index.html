<script>
(function(){
  function findFrame(){
    // ajuste o seletor se tiver um id no iframe (melhor colocar id="bp-pace-iframe")
    return document.getElementById('bp-pace-iframe') ||
           document.querySelector('iframe[src*="eucarloscastro.github.io/baixapace"]') ||
           document.querySelector('iframe[src*="calculadora-de-pace"]');
  }
  function applyHeight(px){
    var f=findFrame(); if(!f) return;
    f.style.height = Math.max(600, px) + 'px';
    f.setAttribute('scrolling','no'); f.style.overflow='hidden';
  }
  function abToFile(buffer, name, mime){
    return new File([new Uint8Array(buffer)], name, { type: mime });
  }

  window.addEventListener('message', async function(e){
    if(!e || !e.data) return;
    if(e.data.type==='bp-resize' && typeof e.data.height==='number'){
      applyHeight(e.data.height);
    }
    if(e.data.type==='bp-share' && e.data.buffer){
      try{
        var file = abToFile(e.data.buffer, e.data.name||'pace-story.jpg', e.data.mime||'image/jpeg');
        if(navigator.canShare && navigator.canShare({ files:[file] })){
          await navigator.share({ files:[file], title:'Calculadora de Pace — Baixa Pace', text:'Meu resultado na Calculadora de Pace' });
        }else{
          // fallback: abre em nova aba (usuário salva manualmente)
          var url = URL.createObjectURL(file);
          window.open(url,'_blank');
          setTimeout(()=>URL.revokeObjectURL(url), 12000);
        }
      }catch(_){}
    }
    if(e.data.type==='bp-open' && e.data.dataURL){
      // abre nova aba com a imagem (iOS -> "Salvar Imagem")
      window.open(e.data.dataURL, '_blank');
    }
  });

  // ajuste inicial de altura preventivo
  setTimeout(()=>applyHeight(900), 400);
})();
</script>

